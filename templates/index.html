<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin-top: 50px;
        }
        .card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #0d6efd;
            color: white;
            font-weight: bold;
        }
        .btn-primary {
            background-color: #0d6efd;
            border: none;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
        }
        .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="card-header text-center">
                <h3>Text-to-Speech</h3>
            </div>
            <div class="card-body">
                <form id="speechForm">
                    <!-- Text Input -->
                    <div class="mb-3">
                        <label for="text" class="form-label">Enter Text:</label>
                        <textarea class="form-control" id="text" name="text" rows="4" required></textarea>
                    </div>

                    <!-- Language Selection -->
                    <div class="mb-3">
                        <label for="language" class="form-label">Select Language:</label>
                        <select class="form-select" id="language" name="language" required>
                            {% for code, name in languages.items() %}
                                <option value="{{ code }}">{{ name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Voice Selection -->
                    <div class="mb-3">
                        <label for="voice" class="form-label">Select Voice:</label>
                        <select class="form-select" id="voice" name="voice" required>
                            {% for voice in voices %}
                                <option value="{{ voice['ShortName'] }}">{{ voice['ShortName'] }} ({{ voice['Locale'] }})</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Volume Control -->
                    <div class="mb-3">
                        <label for="volume" class="form-label">Volume:</label>
                        <input type="range" class="form-range" id="volume" name="volume" min="0" max="100" value="100">
                        <span id="volumeValue">100%</span>
                    </div>

                    <!-- Buttons -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">Generate Speech</button>
                        <button type="button" class="btn btn-secondary" id="saveButton" disabled>Save Audio</button>
                    </div>
                </form>

                <!-- Audio Player -->
                <div class="mt-4">
                    <audio id="audioPlayer" controls class="w-100" style="display: none;">
                        Your browser does not support the audio element.
                    </audio>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById("speechForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = {
                text: document.getElementById("text").value,
                voice: document.getElementById("voice").value,
                volume: document.getElementById("volume").value,
            };

            const response = await fetch("/speak", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
            });

            if (response.ok) {
                const blob = await response.blob();
                const audioUrl = URL.createObjectURL(blob);
                const audioPlayer = document.getElementById("audioPlayer");
                audioPlayer.src = audioUrl;
                audioPlayer.style.display = "block";
                audioPlayer.play();

                // Enable the Save button
                const saveButton = document.getElementById("saveButton");
                saveButton.disabled = false;
                saveButton.addEventListener("click", () => {
                    const a = document.createElement("a");
                    a.href = audioUrl;
                    a.download = "speech.mp3";
                    a.click();
                });
            } else {
                alert("Failed to generate speech. Please try again.");
            }
        });

        // Update volume value display
        document.getElementById("volume").addEventListener("input", (e) => {
            document.getElementById("volumeValue").textContent = `${e.target.value}%`;
        });
    </script>
</body>
</html>
